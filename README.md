# Сервис для назначения ревьюеров на Pull Request

Привет! Это мой проект для стажировки в Авито. Задача была сделать небольшой сервис, который помогает командам разработки автоматизировать назначение ревьюеров на Pull Request (PR).

## Что это такое и как работает?

Основная идея — когда автор создает новый PR, сервис сам находит одного или двух свободных коллег из его же команды и назначает их в ревьюеры. Это экономит время, потому что не нужно вручную пинговать людей.

**Ключевые фичи:**
- **Автоназначение:** Создаешь PR — получаешь до двух ревьюеров автоматом.
- **Управление командами:** Можно создавать команды и добавлять в них участников.
- **Статус пользователя:** Можно сделать пользователя "неактивным", и ему перестанут приходить новые ревью.
- **Переназначение:** Если ревьюер занят, можно попросить сервис найти ему замену.
- **Просмотр своих ревью:** Любой пользователь может получить список PR, которые висят на нём.

## Как запустить проект?

Проще всего поднять всё через Docker. Убедись, что у тебя установлены **Docker** и **Docker Compose**.

1.  Склонируй репозиторий.
2.  В терминале, в корне проекта, выполни команду:
    ```bash
    docker-compose up
    ```
3.  Готово! Сервис запустится и будет доступен на `http://localhost:8080`. База данных PostgreSQL тоже поднимется в контейнере, и все нужные таблицы создадутся сами (миграции применяются при старте).

Если хочешь остановить всё, нажми `Ctrl+C` в терминале, а потом выполни:
```bash
docker-compose down
```

## Как пользоваться API?

Я набросал несколько примеров с `curl`.

> **Важно:** У некоторых запросов есть простая авторизация. Где-то нужен "токен админа" (`X-Admin-Token`), где-то — "токен пользователя" (`X-User-Token`). В рамках тестового задания в качестве токена можно передавать любую непустую строку, например `admin123`.

#### 1. Создать команду

```bash
curl -X POST http://localhost:8080/team/add \
  -H "Content-Type: application/json" \
  -d 
'{'
    "team_name": "backend-team",
    "members": [
      {"user_id": "user1", "username": "Anna", "is_active": true},
      {"user_id": "user2", "username": "Boris", "is_active": true},
      {"user_id": "user3", "username": "Clara", "is_active": true}
    ]
  }'
```

#### 2. Создать Pull Request

Допустим, `user1` (Anna) создаёт PR. Сервис найдёт двух ревьюеров из её команды (например, `user2` и `user3`).

```bash
curl -X POST http://localhost:8080/pullRequest/create \
  -H "Content-Type: application/json" \
  -H "X-Admin-Token: admin123" \
  -d 
'{'
    "pull_request_id": "pr-awesome-feature",
    "pull_request_name": "New awesome feature",
    "author_id": "user1"
  }'
```

#### 3. Переназначить ревьюера

Допустим, `user2` (Boris) не может посмотреть PR. Попросим сервис найти ему замену.

```bash
curl -X POST http://localhost:8080/pullRequest/reassign \
  -H "Content-Type: application/json" \
  -H "X-Admin-Token: admin123" \
  -d 
'{'
    "pull_request_id": "pr-awesome-feature",
    "old_user_id": "user2"
  }'
```

## Мысли и решения в ходе разработки

В процессе были моменты, где нужно было принять решение. Вот некоторые из них:

-   **Авторизация.** В задании была упрощенная схема, я ее и реализовал через кастомные заголовки. Понятно, что в реальной жизни тут был бы JWT или OAuth2, но для тестового это показалось избыточным.
-   **Случайный выбор ревьюера.** Я использовал стандартный `math/rand`. Знаю, что для криптографии он не подходит, но для нашей задачи (просто выбрать случайного коллегу) его более чем достаточно.
-   **Запуск миграций.** Чтобы всё поднималось одной командой `docker-compose up`, я встроил запуск миграций прямо в код приложения. Сервис при старте сначала ждет, пока база данных станет доступна, накатывает миграции, и только потом запускается. Удобно!
-   **Идемпотентность.** Операция мержа PR сделана идемпотентной. Если случайно отправить запрос на мерж дважды, ошибки не будет — сервис просто вернет уже смерженный PR.

## Стек технологий

-   **Язык:** Go
-   **Веб-фреймворк:** Gin (очень понравился, простой и быстрый)
-   **База данных:** PostgreSQL
-   **Миграции:** `golang-migrate`
-   **Контейнеры:** Docker

Спасибо за интерес к моему проекту!